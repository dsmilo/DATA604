---
title: 'DATA 604 Assignment 4: First Simio Models'
author: "Dan Smilowitz"
date: "February 24, 2017"
output:
  pdf_document: 
    fig_height: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE, fig.align='center')
```


## Chapter 2, Problem 9
A deterministic distribution $D$ has a constant value $d$ -- this can be represented as having a mean $\mu = d$ with a standard deviation of zero $\sigma = 0$.

The utilization can be calculated simply using
$$\rho = \frac{\lambda}{\mu} = \frac{\lambda}{d}$$

Using the formula for an $M/G/1$ system (where the general distribution $G$ is in this case the deterministic distribution $D$):
$$W_q = \frac{\lambda \left( \sigma^2+ \frac{1}{\mu} \right)}{2 \left( 1 - \frac{\lambda}{\mu} \right)} =
\frac{\lambda \left( 0^2+ \frac{1}{d} \right)}{2 \left( 1 - \frac{\lambda}{d} \right)} =
\frac{\lambda}{2d - 2 \lambda}$$

Using Little's Law, the remaining metrics can be calculated:
$$L_q = \lambda W_q = \frac{\lambda^2}{2d - 2 \lambda}$$

$$W = W_q + E(S) = \frac{\lambda}{2d - 2 \lambda} + \frac{1}{d}$$

$$L = \lambda W = \frac{\lambda^2}{2d - 2 \lambda} + \frac{\lambda}{d}$$

For these results to be valid, the constant service rate must not be less than the interarrival rate (i.e. $d \geq \lambda$) to avoid utilization greater than 1 or negative queue lengths or times.

If the service time distribution were replaced with one with an equal mean, but with some variation (i.e. $\mu = d$; $\sigma > 0$), the utilization would remain the same, as it is based only on $\lambda$ and $\mu$.

However, $W_q$ would increase:

$$W_q = \frac{\lambda \left( \sigma^2+ \frac{1}{\mu} \right)}{2 \left( 1 - \frac{\lambda}{\mu} \right)} =
\frac{\sigma^2 \lambda d + \lambda}{2d - 2 \lambda}$$

This value has increased by $\sigma^2 \lambda d/(2d - 2 \lambda)$.  The relationships laid out by Little's Law necessitate that each of the remaining metrics would also increase.


\newpage
## Chapter 4, Problem 15
### Expected Values
With $\lambda = 1$ and $d = 1/0.9 \approx 1.111$, the expected values for the deterministic distribution $D$ are
$$\rho = \frac{\lambda}{d} = \frac{1}{1/0.9} = 0.9$$
$$W_q = \frac{\lambda}{2d - 2 \lambda} = \frac{1}{2\times 1.111 - 2} = 4.5$$
$$L_q = \frac{\lambda^2}{2d - 2 \lambda} = \frac{1^2}{2\times 1.111 - 2} = 4.5$$
$$W = \frac{\lambda}{2d - 2 \lambda} + \frac{1}{d} = \frac{1}{2\times 1.111 - 2} + 0.9 = 5.4$$
$$L = \frac{\lambda^2}{2d - 2 \lambda} + \frac{\lambda}{d} = \frac{1^2}{2\times 1.111 - 2} + 0.9 = 5.4$$


### Simulated Values
An $M/D/1$ model is set up with the following parameters:

  - Source with interarrival time `Random.Exponential(1)`
  - Server with processing time `0.9` (times are given as *services per minute* not *minutes per service*)

![](wk4_det.PNG)

\newpage
An experiment is run using this model with the following parameters:

  - 250 replications
  - 30 hour run time
  - 20 hour warm-up period
  - 5 responses:
    - $\rho$ = `DetServer.ResourceState.PercentTime(1)`
    - $W_q$ = `DetServer.InputBuffer.Contents.AverageTimeWaiting`
    - $L_q$ = `DetServer.InputBuffer.Contents.AverageNumberWaiting`
    - $W$ = `DefaultEntity.Population.TimeInSystem.Average`
    - $L$ = `DefaultEntity.Population.NumberInSystem.Average`

This experiment produces the following results:
```{r det, echo=FALSE}
q_vars <- c('$\\rho$', '$W_q$', '$L_q$', '$W$', '$L$')
det_q  <- c(0.9, 4.5, 4.5, 5.4, 5.4)
det_ci <- c("$0.903 \\pm 0.005$",
            "$4.190 \\pm 0.293$", "$4.274 \\pm 0.327$",
            "$5.089 \\pm 0.293$", "$5.177 \\pm 0.331$")
pander::pander(data.frame(Metric = q_vars,
                          `Queueing` = det_q,
                          `Simulated` = det_ci,
                          check.names = FALSE))
```

Each of these confidence intervals includes the estimated mean for the metric, so it can be said with strong confidence that the model is verified.

### Model with Variation
A separate model is created for an $M/G/1$ system with the following parameters

  - Source with interarrival time `Random.Exponential(1)`
  - Server with processing time `Random.Normal(0.9, 0.2)` *normal distribution with same mean*


An experiment is run using this model with the same conditions and responses outlined above.  The results of this experiment are presented below:
```{r norm, echo=FALSE}
norm_ci <- c("$0.898 \\pm 0.004$",
             "$4.073 \\pm 0.264$", "$4.111 \\pm 0.285$",
             "$4.974 \\pm 0.264$", "$5.009 \\pm 0.288$")
pander::pander(data.frame(Metric = q_vars, Simulated = norm_ci))
```

In the above discussion, it was theorized that the introduction would raise the time in queue $W_q$ by $\sigma^2 \lambda d/(2d - 2 \lambda)$ (in this case 0.2) and a corresponding increase in all other metrics besides $\rho$.  However, the results generated by the simulation showed a decrease in each of these metrics -- this result is a bit confusing and may indicate the need for tweaking of the experimental parameters.
